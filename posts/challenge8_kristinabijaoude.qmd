---
<<<<<<< Updated upstream
title: "Challenge 8 Kristin Abijaoude"
author: "Kristin Abijaoude"
description: "Joining Data"
date: "12/12/2022"
=======
title: "Kristin Abijaoude Challenge 8"
author: "Kristin Abijaoude"
description: "Joining Data"
date: "12/09/2022"
>>>>>>> Stashed changes
format:
  html:
    toc: true
    code-copy: true
    code-tools: true
categories:
  - challenge_8
  - faostat
<<<<<<< Updated upstream
  - kristinabijaoude
=======
  - kristin_abijaoude
>>>>>>> Stashed changes
---

```{r}
#| label: setup
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)
<<<<<<< Updated upstream
=======
library(ggridges)
library(ggplot2)
library(dplyr)
library(viridis)
library(hrbrthemes)
library(plotly)
>>>>>>> Stashed changes

knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

<<<<<<< Updated upstream
## Challenge Overview

Today's challenge is to:

1)  read in multiple data sets, and describe the data set using both words and any supporting information (e.g., tables, etc)
2)  tidy data (as needed, including sanity checks)
3)  mutate variables as needed (including sanity checks)
4)  join two or more data sets and analyze some aspect of the joined data

(be sure to only include the category tags for the data you use!)

:::{.panel-tabset}

## FAOSTAT: Reading Data

:::{.panel-tabset}

### Open Cattle Dairy Data

```{r}
# open cattle data
library(readr)
FAO_cattle <- read_csv("_data/FAOSTAT_cattle_dairy.csv")
FAO_cattle
```
:::{.panel-tabset}

### Open Country Group Data

```{r}
# open country data
FAO_country <- read_csv("_data/FAOSTAT_country_groups.csv")
FAO_country
```
:::{.panel-tabset}

### Open Egg Chicken Data

```{r}
# open egg chicken data
FAO_egg <- read_csv("_data/FAOSTAT_egg_chicken.csv")
FAO_egg
```
:::{.panel-tabset}

### Open Livestock Data

```{r}
# open livestock data
FAO_livestock <- read_csv("_data/FAOSTAT_livestock.csv") 
FAO_livestock
```
:::{.panel-tabset}

## FAOSTAT: Tidying Data

```{r}
# in this dataset, several places overlap with one another. for example, Africa overlaps with African countries like Algeria and Zimbabwe, and the World overlaps with... all countries
countrydata <- FAO_country %>%
  rename(country_group = `Country Group`)  %>%
  distinct()

# sanity checkpoint
countrydata

# let's use Africa as an example 
countrydata %>%
  filter(country_group == "Africa")
```

```{r}
half <- countrydata %>%
  group_by(country_group) %>%
  summarise(n=n()) %>%
  arrange(desc(n))
otherhalf <- c(1:round(nrow(half)/2))

knitr::kable(list(half[otherhalf,],
                  matrix(numeric(), nrow=0, ncol=1),
                  half[-otherhalf,]),
             caption = "Countries in Country Groups")
```

```{r}
countrydatawide <- countrydata %>%
  filter(country_group!= "World") %>%
  pivot_wider(names_from = country_group, values_from = 1) %>%
  
# sanity check point
countrydatawide
colnames(countrydatawide) # include column names as well
```

```{r}

=======
## Read in data

For this challenge, I used the FAOSTAT Livestock dataset and the FAOSTAT country dataset for the purpose of joining the two together. I didn't really know where to start on this challenge, so I went through some solutions for inspiration, but eventually, I wanted to figure out how to combine the two datasets myself.

Both of the datasets came from the Food and Agricultural Organization of the United Nations, which compiled data about food and food sources from 1961 to the present. Their mission is to end world hunger and food insecurity. 

The livestock dataset consist of types of livestocks used as a source of food, such as cattles, pigs, and sheep. I opened that set first.

```{r}
# open livestock csv dataset
FAO_livestock <- read_csv("_data/FAOSTAT_livestock.csv")
FAO_livestock
```

The second dataset I opened was the country dataset, which included country groups, such as continents and socioeconomic organizations such as OECD. 

```{r}
# open country csv dataset
FAO_country <- read_csv("_data/FAOSTAT_country_groups.csv")
FAO_country
```
To start the joining process, I renamed a column in the livestock dataset from "Area" to "Country" because I needed a common variable to combine the two datasets together.

```{r}
FAO_livestock <- FAO_livestock %>% rename("Country" = "Area")
FAO_livestock
```
After I renamed the variable, I combined the two dataset with `merge()` and created a new dataframe from it.

```{r}
livestock_merge <- merge(x = FAO_livestock, y = FAO_country, by = "Country", all = TRUE)
livestock_merge
```
```{r}
dim(livestock_merge)
```

The new datatset has `552,040` rows and `20` columns, which was a lot of data.

With the new dataset, I could create visualizations and graphs by country groups, such as by continents or by socioeconomic groups. Even I could create a timeline of livestock distribution in any given country. 

```{r}
livestock_merge %>%
  filter(str_detect(`Country Group`, "[Dd]evelop|OECD")) %>%
  distinct()%>%
  ggplot(aes(y =`Country Group`, x= Value, fill = `Country Group`)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  scale_x_continuous(limits = c(1000, 500000)) +
  xlab("Number of Livestocks") +
  ggtitle("Number of Livestock by Socioeconomic Group")
# I did have to scale down the graph for illustrative purposes
```

```{r}
livestock_item <- livestock_merge %>%
  count(Item) %>%
  na.omit()

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#000000")
  
ggplot(livestock_item, aes(x=Item, y=n, fill = Item)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = cbPalette) +
  ggtitle("Number of Livestocks from 1961-Present day") +
  xlab("Types of Livestock") +
  ylab("Quantity of Livestocks")
```

```{r}
# distribution of livestock by item in Afghanistan alone
afghan <- livestock_merge %>%
  select(c(Country,Value,Item,Year)) %>%
  filter(str_detect(Country, "Afghanistan")) %>%
  unique() %>%
  arrange(desc(Year))

afg <- afghan %>%
  ggplot( aes(x=Year, y=Value, fill=Item, text=Item)) +
  geom_area( ) +
  scale_fill_viridis(discrete = TRUE) +
  theme(legend.position="none") +
  ggtitle("Livestock Distribution in Afghanistan from 1961 to 2018") +
  xlab("Year") +
  ylab("Number of Livestocks") +
  theme_ipsum() +
  theme(legend.position="none")

# make it interactive
afg <- ggplotly(afg, tooltip="text")
afg
>>>>>>> Stashed changes
```

